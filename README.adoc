= Lutaml::Xsd

== Overview

**Lutaml::Xsd** is a *Ruby* gem designed to parse and build *XML Schema Definition (XSD)* objects. It provides a robust framework for handling *XSD* *elements*, *attributes*, and *complex types*, allowing users to manipulate and generate *XSD* objects programmatically.

== Installation

To install *Lutaml::Xsd*, add this line to your application's Gemfile:

[source,ruby]
----
gem 'lutaml-xsd'
----

And then execute:

[source,bash]
----
bundle install
----

Or install it by running:

[source,bash]
----
gem install lutaml-xsd
----

== Usage

=== Parsing XSD Files

To parse an *XSD* file, you can use the `Lutaml::Xsd.parse` method. This method takes the content of an *XSD* file as a string and optional parameters such as the location of the *XSD* file for resolving relative paths.

[source,ruby]
----
require 'lutaml/xsd'

xsd_content = File.read('path/to/your/schema.xsd')
parsed_schema = Lutaml::Xsd.parse(xsd_content, location: 'path/to/your/')
----

=== Working with Parsed Data

Once parsed, the data is represented as instances of various classes such as `Lutaml::Xsd::Schema`, `Lutaml::Xsd::Element`, and others. These objects reflect the structure of the *XSD* and can be manipulated or inspected in *Ruby*.

[source,ruby]
----
schema = <<~SCHEMA
<xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <xsd:element name="root">
    ...
  </xsd:element>
  <xsd:element name="root1">
    ...
  </xsd:element>
</xsd:schema>
SCHEMA

parsed_schema = Lutaml::Xsd.parse(schema, location: 'http://example.com/')

# Accessing elements of the schema
elements = parsed_schema.element
elements.each do |element|
  puts "Element Name: #{element.name}"
end
# the output will be:
> Element Name: root
> Element Name: root1
----

=== Serialization

The gem supports serializing the schema back to *XML*. Each class like `Lutaml::Xsd::Schema` has a method `to_xml` that generates the *XML* representation of the object.

[source,ruby]
----
xml_output = parsed_schema.to_xml
puts xml_output
----

== Key Components

=== Schema Representation

The *Lutaml::Xsd::Schema* class represents an *XSD* schema. It includes attributes for various schema properties like target namespace, element form default, and others.

- **Attributes and Elements**: The schema object contains collections of elements, complex types, simple types, etc., which are all accessible via attributes on the `Schema` object.

=== Include and Import Handling

The path provided in `location` via `Lutaml::Xsd.parse(schema, location: 'path/to/your/directory/')` is used for resolving relative paths provided in *include* and *import* element's *schemaLocation* attribute.

Make sure to provide the directory *path*/*URL* in `location` parameter, as it will be used as base path for resolving relative paths.

For example, if *URL* is provided:

[source,ruby]
----
Lutaml::Xsd.parse(xsd_content, location: 'http://example.com/directory/')
----

If local path is provided:

[source,ruby]
----
Lutaml::Xsd.parse(xsd_content, location: 'path/to/your/directory/')
----

[source, xml]
----
<xs:include schemaLocation="<location>/directory2/metaschema.xsd"/>
<!-- AND/OR -->
<xs:import schemaLocation="<location>/metaschema.xsd"/>
----

All schemas specified in the *include* and/or *import* elements will be fetched from their *schemaLocation*, parsed and added to their parent *Lutaml::Xsd::Schema* object.

== Liquid methods

This gem exposes convenient methods for use in Liquid templates via `to_liquid` on parsed objects. Below is a concise reference of the Liquid-enabled helpers organized by module/type.

=== Element (`Lutaml::Xsd::LiquidMethods::Element`)

- `used_by` — Returns complex_types that use/reference this element.
- `attributes` — Returns attribute elements.
- `child_elements` — Returns all nested child elements (resolved across groups/choices/sequences).
- `referenced_name` — Returns the name of the element or its referenced element by `ref`.
- `referenced_type` — Returns the name of the element's `type` if present, or the type name indicated by `ref` if defined.
- `referenced_object` — Resolves and returns the element or its referenced element by `ref`.
- `referenced_complex_type` — Resolves the complex type matching `referenced_type`.

[source,liquid]
----
{% for el in schema.element %}
  Element: {{ el.name }} ({{ el.min_occurrences }}..{{ el.max_occurrences }})
  Type: {{ el.referenced_type }}
  {% assign attrs = el.attributes %}
  {% if attrs.size > 0 %}
    Attributes:
    {% for a in attrs %}
      - {{ a.referenced_name }} ({{ a.cardinality }})
    {% endfor %}
  {% endif %}
{% endfor %}
----

=== Attribute (`Lutaml::Xsd::LiquidMethods::Attribute`)

- `referenced_object` — Returns the actual attribute object, resolving references via `ref` if necessary.
- `referenced_name` — Retrieves the definitive attribute name, using `ref` if not explicitly named.
- `referenced_type` — Retrieves the fully resolved type name for this attribute.
- `cardinality` — Returns `1` for required, `0..1` for optional.

[source,liquid]
----
{% for a in complex_type.attribute %}
  {{ a.referenced_name }}: {{ a.referenced_type }} ({{ a.cardinality }})
{% endfor %}
----

=== AttributeGroup (`Lutaml::Xsd::LiquidMethods::AttributeGroup`)

- `used_by` — Returns complex types that use this attribute group.
- `attribute_elements` — Returns a flattened list of attributes, resolving nested groups.
- `referenced_object` — Resolves and returns the attribute group or its referenced group by `ref`.

[source,liquid]
----
{% for ag in schema.attribute_group %}
  Group {{ ag.name }} used by:
  {% for ct in ag.used_by %}
    - {{ ct.name }}
  {% endfor %}
  Attributes:
  {% for a in ag.attribute_elements %}
    - {{ a.referenced_name }}
  {% endfor %}
{% endfor %}
----

=== ComplexType (`Lutaml::Xsd::LiquidMethods::ComplexType`)

- `used_by` — Returns elements and group elements that reference this type.
- `attribute_elements` — Returns all attributes (including those from groups and simple content extensions).
- `direct_child_elements` — Returns direct child elements, excluding attributes, attribute groups, annotations, and any attributes.
- `child_elements` — Returns all child elements (across sequences/choices/groups).
- `find_elements_used(element_name)` — Boolean indicating if an element name is used within this type.
- `find_used_by(object)` — Boolean indicating if this complex type is used by the given object.

[source,liquid]
----
{% for ct in schema.complex_type %}
  ComplexType: {{ ct.name }}
  Elements:
  {% for el in ct.child_elements %}
    - {{ el.referenced_name }}
  {% endfor %}
  Attributes:
  {% for a in ct.attribute_elements %}
    - {{ a.referenced_name }}
  {% endfor %}
{% endfor %}
----

=== Group (`Lutaml::Xsd::LiquidMethods::Group`) and Sequence (`...::Sequence`) and Choice (`...::Choice`)

- `child_elements` — Returns all nested `Element` instances contained within.
- `find_elements_used(element_name)` — Boolean indicating if an element name is used within this container.
- All three include the same helper surface and resolve nested structures consistently.

[source,liquid]
----
{% for g in schema.group %}
  Group {{ g.name }} elements:
  {% for el in g.child_elements %}
    - {{ el.referenced_name }}
  {% endfor %}
{% endfor %}
----

=== SimpleContent (`Lutaml::Xsd::LiquidMethods::SimpleContent`)

- `attribute_elements` — Returns attributes coming from the `extension` and nested attribute groups.
- `base_type` — Returns the base type from `base`, `extension.base`, or `restriction.base`.

[source,liquid]
----
{% assign attrs = ct.simple_content.attribute_elements %}
{% for a in attrs %}
  - {{ a.referenced_name }} ({{ a.cardinality }})
{% endfor %}
----

=== Extension (`Lutaml::Xsd::LiquidMethods::Extension`)

- `attribute_elements` — Returns attributes of the extension and its attribute groups.

[source,liquid]
----
{% for a in ct.simple_content.extension.attribute_elements %}
  - {{ a.referenced_name }}
{% endfor %}
----

=== Base Class Methods (`Lutaml::Xsd::Base`)

The following methods are available on all XSD objects via the base class:

Type checking methods:
- `any?` — Returns `true` if the object is an `Any` instance.
- `all?` — Returns `true` if the object is an `All` instance.
- `choice?` — Returns `true` if the object is a `Choice` instance.
- `element?` — Returns `true` if the object is an `Element` instance.
- `sequence?` — Returns `true` if the object is a `Sequence` instance.
- `attribute?` — Returns `true` if the object is an `Attribute` instance.
- `annotation?` — Returns `true` if the object is an `Annotation` instance.
- `simple_content?` — Returns `true` if the object is a `SimpleContent` instance.
- `attribute_group?` — Returns `true` if the object is an `AttributeGroup` instance.

Other methods:
- `min_occurrences` — Returns the minimum occurrences as Integer (default 1). Only available on objects that respond to `min_occurs`.
- `max_occurrences` — Returns `*` for unbounded, otherwise Integer (default 1). Only available on objects that respond to `max_occurs`.
- `to_xml` — Returns the XML representation of the object.
- `to_formatted_xml` — Returns a formatted XML representation of the object.
- `resolved_element_order` — Returns all elements in the order they originally appeared in the XSD.

[source,liquid]
----
{% for item in schema.element %}
  {% if item.element? %}
    Element: {{ item.name }}
    {% if item.min_occurrences %}
      Min: {{ item.min_occurrences }}, Max: {{ item.max_occurrences }}
    {% endif %}
  {% endif %}
{% endfor %}
----

NOTE: The `resolved_element_order` method is available on all objects via the base class (`Lutaml::Xsd::Base`) and returns all elements in the order they originally appeared in the XSD. This method is used internally by many of the liquid methods above.

== Development

- **Dependencies**: The gem depends on `lutaml-model` for model serialization. See the `Gemfile` and `lutaml-xsd.gemspec` for details on dependencies.

- **Testing**: Tests are written using RSpec. Test files and fixtures are located in the `spec` directory.

== About LutaML

The name "LutaML" is pronounced as "Looh-tah-mel".

The name "LutaML" comes from the Latin word for clay, "Lutum", and "ML"
for "Markup Language". Just as clay can be molded and modeled into beautiful and
practical end products, the Lutaml::Model gem is used for data modeling,
allowing you to shape and structure your data into useful forms.


== License and Copyright

This project is licensed under the BSD 2-clause License.
See the link:LICENSE.md[] file for details.

Copyright Ribose.